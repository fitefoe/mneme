<div ng-controller="OverviewCtrl">
  <!-- filter panel -->
  <div class="panel panel-info mneme-panel-filter">
    <!-- filter panel heading -->
    <div ng-click="filter_show = !filter_show"
        class="panel-heading mneme-pointer clearfix">
      <span class="glyphicon glyphicon-filter"></span> Filter
      <!-- arrow pointing down or up -->
      <span ng-show="!filter_show" class="caret"></span>
      <span ng-show="filter_show" class="dropup">
        <span class="caret"></span>
      </span>

      <!-- list of selected filter tags (stop click event propagation to
           preven the panel from closing) -->
      <a href=""
          ng-repeat="tag in filter_tags"
          ng-click="filter_tags_remove(tag); $event.stopPropagation();"
          class="label label-primary mneme-tag mneme-hover-base">
        <span class="glyphicon glyphicon-tag mneme-hover-hide"></span>
        <span class="glyphicon glyphicon-minus-sign mneme-hover-show"></span>
        {{tag}}
      </a>

      <!-- show map restriction label -->
      <a href=""
          ng-click="filter_map = false; $event.stopPropagation();"
          ng-show="filter_map"
          class="label label-default mneme-tag mneme-hover-base">
        <span class="glyphicon glyphicon-globe mneme-hover-hide"></span>
        <span class="glyphicon glyphicon-minus-sign mneme-hover-show"></span>
        map area
      </a>

      <!-- clear filter button -->
      <button
          ng-click="filter_tags = []; filter_map = false; $event.stopPropagation();"
          ng-show="filter_tags.length || filter_map"
          class="btn btn-danger btn-xs pull-right mneme-filter-clear">
        <span class="glyphicon glyphicon-remove"></span> clear
      </button>
    </div>
    <!-- filter panel body -->
    <div collapse="!filter_show">
      <div class="panel-body">
        <div ng-show="filter_tags_remaining.length">
          <label>
            <span class="glyphicon glyphicon-tags mneme-filter-icon"></span>
            Pick one or more of the following tags to filter your mnemes!
          </label>
          <div>
            <a href=""
                ng-repeat="tag in filter_tags_remaining | orderBy: '-count'"
                ng-click="filter_tags_add(tag.name)"
                class="label label-info mneme-tag mneme-hover-base">
              <span class="glyphicon glyphicon-tag mneme-hover-hide"></span>
              <span class="glyphicon glyphicon-plus-sign mneme-hover-show"></span>
              {{tag.name}}
              <span class="mneme-badge">{{tag.count}}</span>
            </a>
          </div>
        </div>
        <label ng-show="!filter_tags_remaining.length">
          <span class="glyphicon glyphicon-tag mneme-filter-icon"></span>
          There are no more tags for refining the filter!
        </label>
        <hr class="small">
        <!-- TODO: map filter -->
        <div>
          <label>
            <button
                ng-model="filter_map" btn-checkbox
                type="button" class="btn btn-default btn-xs">
              <span class="glyphicon glyphicon-globe mneme-filter-icon"></span>
              Restrict to area on map
            </button>
          </label>
          <div collapse="!filter_map">
            <div style="height: 300px; padding-left: 20px; padding-right: 20px; background-color: #DDDDDD;"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- filtererd mneme list -->
  <table class="table table-striped table-hover table-vmiddle">
    <thead>
      <tr>
        <th>Name</th>
        <th>Deadline</th>
        <th>Creation date</th>
        <th ng-if="filter_map">Distance from map center</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <tr ng-repeat="mneme in mnemes_filtered | orderBy: '+name'">
        <td>
          <h4>{{mneme.name}}</h4>
          <span ng-repeat="tag in mneme.tags">
            <span ng-if="!filter_tags_contains(tag)"
                class="mneme-tag label label-info">
              <span class="glyphicon glyphicon-tag"></span>
              {{tag}}
            </span>
          </span>
        </td>
        <td></td>
        <td>11 months ago</td>
        <td ng-if="filter_map">6 km</td>
        <td>
          <button type="button" class="btn btn-primary mneme-btn">
            <span class="glyphicon glyphicon-edit"></span> edit
          </button>
          <button
              ng-click="mnemedb.remove(mneme._id, mneme._rev)"
              type="button" class="btn btn-danger mneme-btn">
            <span class="glyphicon glyphicon-remove"></span> remove
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>
